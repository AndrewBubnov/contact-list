<!DOCTYPE html>
<html lang="en" ng-app="contactList">
<head>
    <meta charset="UTF-8">
    <title>Contact list</title>
    <link rel="stylesheet" href="app.css">
    <script src="lib/angular/angular.js"></script>
    <script>
        const app = angular.module("contactList", [])
        app.controller('contactListController', ($scope, $http) => {
            $scope.items = [];
            const items = $scope.items

            $scope.getError = function (error) {
                if (angular.isDefined(error)) {
                    if (error.required) {
                        return "Empty field";
                    }
                }
            }

            $http.get('http://localhost:3000/')
                .then(response => {
                    console.log('contacts = ', response.data)
                    $scope.items = response.data
                })
                .catch(err => console.log('Error: ', err))

            $scope.addItem = (newContact, isValid) => {
                if (isValid) {
                    const contact = JSON.parse(JSON.stringify(newContact))
                    contact.id = items.length;
                    contact.fullName = contact.firstName + ' ' + contact.lastName;
                    items.push(contact)
                    Object.keys(newContact).forEach(item => newContact[item] = '')
                    $scope.showError = false;

                    $http.post('http://localhost:3000/api', JSON.stringify(contact))
                        .then(response => console.log(response.data))
                        .catch(err => console.log('Error: ', err))

                } else {
                    $scope.message = "Error";
                    $scope.showError = true;
                }
            }

            $scope.deleteItem = (id) => {
                $scope.items.splice(items.indexOf(items.find(element => element.id === id)), 1)
            }

            $scope.editItem = (id) => {
                items.filter(element => element.id === id)[0].edited = true
            }

            $scope.saveItem = (item) => {
                const element = items.find(element => element.id === item.id)
                item.fullName = item.firstName + ' ' + item.lastName
                items.splice(items.indexOf(element), 1, item)
                element.edited = false
            }
        })
    </script>
</head>
<body ng-controller="contactListController">
<!--<form name="inputForm" ng-submit="addItem(contact, inputForm.$valid)">-->
<form name="inputForm">
    <div class="wrapper">
    <div class="inner-wrapper">
        <input required ng-model="contact.firstName" placeholder="First Name" class="input-item" name="firstName"/>
        <div class="error" ng-show="showError">
            {{getError(inputForm.firstName.$error)}}
        </div>
    </div>
    <div class="inner-wrapper">
        <input required ng-model="contact.lastName" placeholder="Last Name" class="input-item" name="lastName"/>
        <div class="error" ng-show="showError">
            {{getError(inputForm.lastName.$error)}}
        </div>
    </div>
    <div class="inner-wrapper">
        <input required ng-model="contact.phone" placeholder="Phone" class="input-item" name="phone"/>
        <div class="error" ng-show="showError">
            {{getError(inputForm.phone.$error)}}
        </div>
    </div>
    <div class="inner-wrapper">
        <input required ng-model="contact.cellPhone" placeholder="Cell phone" class="input-item" name="cellPhone"/>
        <div class="error" ng-show="showError">
            {{getError(inputForm.cellPhone.$error)}}
        </div>
    </div>
    <div class="inner-wrapper">
        <input required ng-model="contact.address" placeholder="Address" class="input-item" name="address"/>
        <div class="error" ng-show="showError">
            {{getError(inputForm.address.$error)}}
        </div>
    </div>
    <button type="submit" ng-click="addItem(contact, inputForm.$valid)" class="add-button btn">Add</button>
    </div>


</form>
<div ng-repeat="item in items" class="record-container">
    <div>
        <input ng-if="item.edited" ng-model="item.firstName" class="input-item">

        <div class="record-item" ng-if="!item.edited">
            {{item.firstName}}
        </div>

        <input ng-if="item.edited" ng-model="item.lastName" class="input-item">
        <div class="record-item" ng-if="!item.edited">
            {{item.lastName}}
        </div>
        <input ng-if="item.edited" ng-model="item.phone" class="input-item">
        <div class="record-item" ng-if="!item.edited">
            {{item.phone}}
        </div>
        <input ng-if="item.edited" ng-model="item.cellPhone" class="input-item">
        <div class="record-item" ng-if="!item.edited">
            {{item.cellPhone}}
        </div>
        <input ng-if="item.edited" ng-model="item.address" class="input-item">
        <div class="record-item" ng-if="!item.edited">
            {{item.address}}
        </div>
        <input ng-if="item.edited" ng-model="item.fullName" class="input-item">
        <div class="record-item" ng-if="!item.edited">
            {{item.fullName}}
        </div>
    </div>
    <div class="buttons">
        <button ng-click="deleteItem(item.id)" class="btn">Delete</button>
        <div>
            <button ng-if="!item.edited" ng-click="editItem(item.id)" class="btn">Edit</button>
            <button ng-if="item.edited" ng-click="saveItem(item)" class="btn">Save</button>
        </div>
    </div>
</div>
</body>
</html>